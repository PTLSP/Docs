---
title: 批量获取当前路径文件URL
date: 2024-01-27 23:12:36
updated: 2024-01-27 23:12:36
swiper_index: 
description: 批量获取当前路径文件URL
permalink: /getfileurl/
cover: https://img.ptlsp.com/day
tags: 
- 随机图
- 代码
- 源码
- 宝塔
categories: 
- 原创教程
---

## 前言

我之前做了一个二次元随机图嘛：

![](/img/截屏2024-01-28 上午1.19.39.png)

random.php 直接指向random文件夹下的图片 源码如下：

```
<?php
// 指定图片目录的相对路径
$img_dir = 'random/';

// 获取符合条件的图片列表
$img_list = glob($img_dir . '*.{gif,jpg,png,webp}', GLOB_BRACE);

// 如果图片列表不为空，则随机选择一张图片并输出
if (!empty($img_list)) {
    $img_url = $img_list[array_rand($img_list)];

    // 获取图片类型
    $img_info = getimagesize($img_url);
    if ($img_info !== false) {
        $img_mime = $img_info['mime'];
        header('Content-Type: ' . $img_mime); // 设置输出的内容类型为图片的 MIME 类型
        readfile($img_url);
        exit;
    } else {
        echo 'Failed to determine the image type.';
    }
} else {
    // 如果图片列表为空，则输出错误信息
    echo 'No images found in ' . $img_dir;
}
?>

```

Nginx的伪静态配置如下：


```
location /random {
    rewrite ^/random$ /random.php last;
}

location /cover {
    rewrite ^/random$ /cover.php last;
}

location /gif {
    rewrite ^/random$ /gif.php last;
}

location /4k {
    rewrite ^/random$ /4k.php last;
}
location /mp {
    rewrite ^/random$ /mp.php last;
}
```
目的是为了获取随机图接口地址固定为：

https://xxx.xxx.com/random

指向的实际路径为:https://xxx.xxx.com/random.php

这样能解决某些框架获取不到.php路径 采取的解决办法

效果自然是非常ok 但有个问题就是 虽然路径固定了 random路径下的文件也确实被cloudflare缓存了 但我不确定是不是我单独打开图片真实路径那一刻才缓存上的

## 发现问题点并尝试优化

监控网站源服务器发现上传的流量还是不少 所以就很怀疑是不是没被cf缓存上 每次都从源服务器获取图片 而且random这个接口是获取不到原图片文件夹下的真实路径的 如果用户访问你的博客 非常喜欢这个图 想扒会非常困难 而且也不方便随时调用其他url地址的图片

而我在制作随机图前就知道了php源码是可以通过调用txt文本里面url来实现跳转到图片url或直接调用本地目录图片的url的

我也早就发现有大佬把图片传到gitee仓库 用我这个教程的方法来批量获取图片路径 用跳转的方式来打开图片 那速度嘎嘎快 比cf的cdn快得多！而且还不占用服务器存储！！！

想法有了 可行性也具备了 就差实际行动！接下来就是具体实现教程！

## 利用脚本获取文件夹路径并指定网址前缀

要实现批量获取 random 路径下文件的路径，并在路径前面加上网址 https://xxx.xxx.com ，您可以使用以下脚本来实现：


```
#!/bin/bash

base_url="https://xxx.xxx.com/random/"  # 网址前缀
directory="/www/wwwroot/xxx.xxx.com/random"  # random 路径
output_file="/www/wwwroot/xxx.xxx.com/random.txt"  # 输出文件名

# 遍历目录下的文件
for file in "$directory"/*; do
    if [ -f "$file" ]; then  # 只处理文件，不处理目录
        filename=$(basename "$file")  # 获取文件名
        url="$base_url$filename"  # 构建完整的 URL
        echo "$url" >> "$output_file"  # 输出 URL到文件
    fi
done

```

请将上述脚本中的 /www/wwwroot/xxx.xxx.com/random 替换为您实际的路径。运行脚本后，它将遍历指定目录下的文件，并输出每个文件的完整 URL，其中网址前缀为 https://xxx.xxx.com/。

您可以将脚本保存为一个文件（例如 get_random_urls.sh），并在终端中运行以下命令来执行脚本：

```
bash get_random_urls.sh
```

脚本将输出每个文件的 URL，您可以将输出保存到文件中或按需进行进一步处理。

{% tip warning faa-parent animated-hover %}<p class="faa-horizontal">请注意，脚本假设 random 路径下只包含文件，不包含子目录！所以请单独分类，以上举例请根据实际情况修改。</p>{% endtip %}

### 成功把random文件夹下的图片路径批量获取URL写入到random.txt文件

![](https://t.ptlsp.com/images/2024/01/28/image23bb8216a42fbf1c.png)

### F12已经能够获取到图片的真实路径了

![](/img/截屏2024-01-28 上午1.16.35.png)

没写完没写完没写完！！！！！没写完没写完没写完！！！！！没写完没写完没写完！！！！！
